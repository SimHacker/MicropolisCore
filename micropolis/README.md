# create-svelte

Everything you need to build a Svelte project, powered by [`create-svelte`](https://github.com/sveltejs/kit/tree/main/packages/create-svelte).

## Creating a project

If you're seeing this, you've probably already done this step. Congrats!

```bash
# create a new project in the current directory
npm create svelte@latest

# create a new project in my-app
npm create svelte@latest my-app
```

## Developing

Once you've created a project and installed dependencies with `npm install` (or `pnpm install` or `yarn`), start a development server:

```bash
npm run dev

# or start the server and open the app in a new browser tab
npm run dev -- --open
```

## Building

To create a production version of your app:

```bash
npm run build
```

You can preview the production build with `npm run preview`.

> To deploy your app, you may need to install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment.

## Content Management and Navigation

This SvelteKit application integrates content generated by a separate Jekyll build process.

### Jekyll Integration

- **Build Output:** Jekyll builds Markdown files (expected to be located in a source directory like `../website/pages`) into HTML files within the `./_jekyll_content_build/pages/` directory.
- **Content Loading:** The SvelteKit application assumes a **flat structure** within the build output directory (e.g., `about.html`, `will-wright.html`, `constructionist-education.html` all directly inside `_jekyll_content_build/pages/`).
- **Loading Module:** The `src/lib/server/jekyllContent.js` module handles locating and reading these HTML files based on a content slug.

### Navigation Structure

- **Source of Truth:** Currently, the navigation hierarchy and mapping to content slugs are manually defined in `src/lib/navigationTree.js`.
- **Tree Format:** This file exports a tree structure (`navigationTree`) where each node represents a page or section and contains `slug` (for URL path segment), `title` (for display), `contentSlug` (mapping to the Jekyll HTML filename without extension), and potentially `children` for sub-navigation.
- **Future Enhancement:** This tree could potentially be generated dynamically during the SvelteKit build by scanning the Jekyll source directory (`../website/pages`) and parsing Markdown front matter, making Jekyll the true single source of truth.

### Routing

- **Root Page (`/`):** This is a standard SvelteKit route (`src/routes/+page.svelte`) that directly renders the main `MicropolisView` component. It does not use Jekyll content.
- **Content Pages (`/pages/...`):** All Jekyll-driven content is served under the `/pages/` path prefix.
- **Dynamic Route:** A single generic dynamic route `src/routes/pages/[...path]/` handles all content pages.
- **Server Logic (`+page.server.js`):** The server load function for this route:
    - Parses the `params.path` array.
    - Uses helpers from `navigationTree.js` (`findNode`) to locate the corresponding node in the navigation tree.
    - Uses the `contentSlug` from the node and helpers from `jekyllContent.js` (`getContentFilePath`, `readContentFile`) to load the raw HTML content.
    - Passes the navigation node data and the raw HTML content (`pageContent`) to the page component.
    - Includes an `entries()` function that uses `getAllPaths` from `navigationTree.js` to tell SvelteKit which content pages to prerender during the build.
- **Page Component (`+page.svelte`):** The generic page component:
    - Receives the `node` and `pageContent` data.
    - Renders the page title from `node.title`.
    - Renders the sub-navigation dynamically if `node.children` exists.
    - Renders the raw `pageContent` using `{@html ...}`.
- **Other Routes:** Standard SvelteKit routes (e.g., `/login`, `/admin`) can be created at the root level without conflicting with the `/pages/[...path]` catch-all.

### (Future) Svelte Component Injection

- **Concept:** A mechanism is partially implemented to allow injecting Svelte components directly into specific locations within the Jekyll-generated HTML content.
- **Mechanism:** Place HTML comment markers like `<!-- SVELTE_COMPONENT:ComponentName -->` in your Jekyll Markdown/HTML source files.
- **Server Parsing:** The `src/lib/server/jekyllContent.js` module contains a `readAndParseContentFile` function that can split the HTML content into an array of HTML parts and component placeholders based on these markers.
- **Page Rendering:** The generic `src/routes/pages/[...path]/+page.svelte` has commented-out logic and a component registry (`injectableRegistry`) to render this array, using `{@html}` for HTML parts and `<svelte:component>` for component parts.
- **Current Status:** **Disabled by default.** The server `load` function currently calls `readContentFile` (loading raw HTML) and returns `isParsed: false`. Component injection is **not active**.
- **Enabling (Future):** To enable this for a specific page, you would need to:
    1.  Add metadata (e.g., `injectComponents: true`) to the page's node in `navigationTree.js`.
    2.  Modify the `load` function in `src/routes/pages/[...path]/+page.server.js` to check this metadata and call `readAndParseContentFile` instead of `readContentFile`, returning `isParsed: true`.
    3.  Ensure the required Svelte components are registered in `injectableRegistry` in `src/routes/pages/[...path]/+page.svelte`.
